import{j as e,A as m,S as y,r as a,B as d,a as F,b as x,F as o,u as p,c as S,e as k,P as _,I as u,f as E}from"./index-D2LXoUIo.js";const L="_block_qedgb_1",U={block:L},A=({count:s=3})=>e.jsx(m,{direction:"column",gap:16,children:Array.from({length:s}).map((t,i)=>e.jsx(y,{animated:!0,className:U.block},i))}),P="_profileForm_xbez2_1",I={profileForm:P},M=()=>{const[s,t]=a.useState(!1),i=async()=>{try{t(!0),await F(x)}catch(r){console.error(r)}finally{t(!1)}};return e.jsx(d,{block:!0,disabled:s,loading:s,onClick:i,children:"Выйти"})},C=()=>{const[s,t]=a.useState(!1),[i]=o.useForm(),{data:r,isLoading:l}=p(),[c,{isLoading:g}]=S(),[j,{isLoading:f}]=k(),b=async()=>{try{const n=i.getFieldsValue(!0),h={id:n==null?void 0:n.id,calories_limit:Number(n.calories_limit)};await(h.id?j:c)(h).unwrap(),t(!1)}catch(n){console.error(n)}};return a.useEffect(()=>{s&&r&&i.setFieldsValue(r)},[i,r,s]),e.jsxs(e.Fragment,{children:[e.jsx(d,{block:!0,disabled:l,onClick:()=>t(!0),children:"Настройки"}),e.jsx(_,{visible:s,destroyOnClose:!0,position:"bottom",onMaskClick:()=>t(!1),children:e.jsxs(o,{form:i,onFinish:b,footer:e.jsx(d,{type:"submit",block:!0,color:"primary",disabled:g||f,loading:g||f,children:"Сохранить"}),children:[e.jsx(o.Header,{children:"Настройки профиля"}),e.jsx(o.Item,{name:"calories_limit",label:"Лимит калорий в день",rules:[{required:!0,message:"Укажите лимит"}],children:e.jsx(u,{type:"number",placeholder:"Например, 2000"})})]})})]})},O=a.memo(()=>e.jsxs(m,{gap:16,children:[e.jsx(C,{}),e.jsx(M,{})]})),N=a.memo(()=>{const{data:s,isFetching:t,refetch:i}=p(),[r]=o.useForm();return a.useEffect(()=>{var l,c;t||r.setFieldsValue({email:(c=(l=x)==null?void 0:l.currentUser)==null?void 0:c.email,calorie_limit:s==null?void 0:s.calories_limit})},[r,s,t]),e.jsx(E,{onRefresh:()=>i(),children:t?e.jsx(A,{count:3}):e.jsxs(m,{children:[e.jsxs(o,{form:r,mode:"card",className:I.profileForm,children:[e.jsx(o.Item,{label:"Электронная почта",name:"email",children:e.jsx(u,{readOnly:!0})}),e.jsx(o.Item,{label:"Лимит калорий на день",name:"calorie_limit",children:e.jsx(u,{readOnly:!0})})]}),e.jsx(O,{})]})})});export{N as default};
