import{G as e,H as u,r as a,$ as y,a0 as p}from"./index-pBOzsuKB.js";import{B as d,F as o,I as m}from"./input-AC3NyT7k.js";import{S as F,P as S}from"./pull-to-refresh-gonpTrH0.js";import{u as x,a as k,c as _}from"./firebaseUserService-CpkNB3yp.js";import{P as E}from"./popup-DlgMaGa7.js";const L="_block_qedgb_1",U={block:L},P=({count:s=3})=>e.jsx(u,{direction:"column",gap:16,children:Array.from({length:s}).map((t,r)=>e.jsx(F,{animated:!0,className:U.block},r))}),A="_profileForm_xbez2_1",I={profileForm:A},M=()=>{const[s,t]=a.useState(!1),r=async()=>{try{t(!0),await y(p)}catch(i){console.error(i)}finally{t(!1)}};return e.jsx(d,{block:!0,disabled:s,loading:s,onClick:r,children:"Выйти"})},C=()=>{const[s,t]=a.useState(!1),[r]=o.useForm(),{data:i,isLoading:l}=x(),[c,{isLoading:f}]=k(),[j,{isLoading:g}]=_(),b=async()=>{try{const n=r.getFieldsValue(!0),h={id:n==null?void 0:n.id,calories_limit:Number(n.calories_limit)};await(h.id?j:c)(h).unwrap(),t(!1)}catch(n){console.error(n)}};return a.useEffect(()=>{s&&i&&r.setFieldsValue(i)},[r,i,s]),e.jsxs(e.Fragment,{children:[e.jsx(d,{block:!0,disabled:l,onClick:()=>t(!0),children:"Настройки"}),e.jsx(E,{visible:s,destroyOnClose:!0,position:"bottom",onMaskClick:()=>t(!1),children:e.jsxs(o,{form:r,onFinish:b,footer:e.jsx(d,{type:"submit",block:!0,color:"primary",disabled:f||g,loading:f||g,children:"Сохранить"}),children:[e.jsx(o.Header,{children:"Настройки профиля"}),e.jsx(o.Item,{name:"calories_limit",label:"Лимит калорий в день",rules:[{required:!0,message:"Укажите лимит"}],children:e.jsx(m,{type:"number",placeholder:"Например, 2000"})})]})})]})},O=a.memo(()=>e.jsxs(u,{gap:16,children:[e.jsx(C,{}),e.jsx(M,{})]})),G=a.memo(()=>{const{data:s,isFetching:t,refetch:r}=x(),[i]=o.useForm();return a.useEffect(()=>{var l,c;t||i.setFieldsValue({email:(c=(l=p)==null?void 0:l.currentUser)==null?void 0:c.email,calorie_limit:s==null?void 0:s.calories_limit})},[i,s,t]),e.jsx(S,{onRefresh:()=>r(),children:t?e.jsx(P,{count:3}):e.jsxs(u,{children:[e.jsxs(o,{form:i,mode:"card",className:I.profileForm,children:[e.jsx(o.Item,{label:"Электронная почта",name:"email",children:e.jsx(m,{readOnly:!0})}),e.jsx(o.Item,{label:"Лимит калорий на день",name:"calorie_limit",children:e.jsx(m,{readOnly:!0})})]}),e.jsx(O,{})]})})});export{G as default};
