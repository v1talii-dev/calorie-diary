import{j as e,A as u,S as y,r as a,B as c,a as F,b as f,F as o,u as p,c as S,e as k,P as _,I as d}from"./index-DrsYMwNw.js";const E="_block_qedgb_1",L={block:E},U=({count:s=3})=>e.jsx(u,{direction:"column",gap:16,children:Array.from({length:s}).map((i,t)=>e.jsx(y,{animated:!0,className:L.block},t))}),A="_profileForm_xbez2_1",I={profileForm:A},P=()=>{const[s,i]=a.useState(!1),t=async()=>{try{i(!0),await F(f)}catch(r){console.error(r)}finally{i(!1)}};return e.jsx(c,{block:!0,disabled:s,loading:s,onClick:t,children:"Выйти"})},M=()=>{const[s,i]=a.useState(!1),[t]=o.useForm(),{data:r,isLoading:l}=p(),[h,{isLoading:m}]=S(),[j,{isLoading:g}]=k(),b=async()=>{try{const n=t.getFieldsValue(!0),x={id:n==null?void 0:n.id,calories_limit:Number(n.calories_limit)};await(x.id?j:h)(x).unwrap(),i(!1)}catch(n){console.error(n)}};return a.useEffect(()=>{s&&r&&t.setFieldsValue(r)},[t,r,s]),e.jsxs(e.Fragment,{children:[e.jsx(c,{block:!0,disabled:l,onClick:()=>i(!0),children:"Настройки"}),e.jsx(_,{visible:s,destroyOnClose:!0,position:"bottom",onMaskClick:()=>i(!1),children:e.jsxs(o,{form:t,onFinish:b,footer:e.jsx(c,{type:"submit",block:!0,color:"primary",disabled:m||g,loading:m||g,children:"Сохранить"}),children:[e.jsx(o.Header,{children:"Настройки профиля"}),e.jsx(o.Item,{name:"calories_limit",label:"Лимит калорий в день",rules:[{required:!0,message:"Укажите лимит"}],children:e.jsx(d,{type:"number",placeholder:"Например, 2000"})})]})})]})},C=a.memo(()=>e.jsxs(u,{gap:16,children:[e.jsx(M,{}),e.jsx(P,{})]})),w=a.memo(()=>{const{data:s,isFetching:i}=p(),[t]=o.useForm();return a.useEffect(()=>{var r,l;i||t.setFieldsValue({email:(l=(r=f)==null?void 0:r.currentUser)==null?void 0:l.email,calorie_limit:s==null?void 0:s.calories_limit})},[t,s,i]),i?e.jsx(U,{count:3}):e.jsxs(u,{children:[e.jsxs(o,{form:t,mode:"card",className:I.profileForm,children:[e.jsx(o.Item,{label:"Электронная почта",name:"email",children:e.jsx(d,{readOnly:!0})}),e.jsx(o.Item,{label:"Лимит калорий на день",name:"calorie_limit",children:e.jsx(d,{readOnly:!0})})]}),e.jsx(C,{})]})});export{w as default};
